<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Urban Gardening with Automation | Sewen Thy</title> <meta name="author" content="Sewen Thy"/> <meta name="description" content="Initial work for the garden and some planning for future automation"/> <meta name="keywords" content="sewenthy, sewen, thy, backend, engineer, software, ocaml, scala, golang, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/favicon.ico"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://site.sewenthy.dev/blog/2024/1_gardening_starting/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Sewen Thy</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Urban Gardening with Automation</h1> <p class="post-meta">June 16, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/zigbee"> <i class="fas fa-hashtag fa-sm"></i> zigbee</a>   <a href="/blog/tag/gardening"> <i class="fas fa-hashtag fa-sm"></i> gardening</a>   <a href="/blog/tag/urban"> <i class="fas fa-hashtag fa-sm"></i> urban</a>   <a href="/blog/tag/home-assistant"> <i class="fas fa-hashtag fa-sm"></i> home-assistant</a>   <a href="/blog/tag/home-automation"> <i class="fas fa-hashtag fa-sm"></i> home-automation</a>   <a href="/blog/tag/zha"> <i class="fas fa-hashtag fa-sm"></i> zha</a>   <a href="/blog/tag/butterfly-pea"> <i class="fas fa-hashtag fa-sm"></i> butterfly-pea</a>   <a href="/blog/tag/bee"> <i class="fas fa-hashtag fa-sm"></i> bee</a>     ·   <a href="/blog/category/gardening"> <i class="fas fa-tag fa-sm"></i> gardening</a>   <a href="/blog/category/home-automation"> <i class="fas fa-tag fa-sm"></i> home-automation</a>   </p> </header> <article class="post-content"> <p>Since graduating in 2023, one of the biggest things I missed about Yale-NUS was the green campus. Everywhere I look there’d always be some piece of green. My suitemates were even more into plants than me, so when I walked into their rooms, there were always some potted plants and long leafy vines growing from the top of their bookcases. But I was never a fan of dirt spilling from the plants onto my floor and more importantly, I never felt responsible enough to take care of them, so I never had any while I was at school.</p> <p>Since I moved out I have been playing around with home automation using <a href="https://www.home-assistant.io/" target="_blank" rel="noopener noreferrer">Home Assistant (HA)</a> using the <a href="https://www.home-assistant.io/integrations/zha/" target="_blank" rel="noopener noreferrer">Zigbee Home Automation (ZHA)</a>. I realized that while I still may forget to water my plants, I can get my garden to water itself–and I can make cool graphs with my sensor data.</p> <h1 id="picking-the-plants">Picking the plants</h1> <p>I have been trying to have a more vegetarian diet so I wanted to priorities my favorites such as <a href="https://gardeningsg.nparks.gov.sg/page-index/edible-plants/brinjal/" target="_blank" rel="noopener noreferrer">eggplants (brinjal)</a>, <a href="https://gardeningsg.nparks.gov.sg/page-index/edible-plants/tomato/" target="_blank" rel="noopener noreferrer">tomatoes</a> and <a href="https://gardeningsg.nparks.gov.sg/page-index/edible-plants/winged-bean/" target="_blank" rel="noopener noreferrer">winged beans</a>. After some quick googling, I found that the Singapore government encourages all these gardening efforts and even has amazing resources on how to get them growing.</p> <p>However, as I read through I realized I forgot about one important thing: bees. Aside from winged beans most of the veggies I like need pollination and so need some kind of pollinators. As I live on the 20th floors, I wasn’t sure if they would come all the way up. I needed something to check first so I decided to start small: <a href="https://gardeningsg.nparks.gov.sg/page-index/edible-plants/butterfly-pea/" target="_blank" rel="noopener noreferrer">butterfly peas</a>. These are even <a href="https://gardeningsg.nparks.gov.sg/page-index/edible-plants/butterfly-pea/" target="_blank" rel="noopener noreferrer">considered weeds</a> in some cases because they grow so easily so I’m making my life easier and they have the added benefit of being a bees-attractor.</p> <h1 id="getting-supplies-and-starting-the-seedlings">Getting supplies and starting the seedlings</h1> <p>After consulting more internet resources, I found out I needed the following:</p> <ul> <li>some loamy soils*</li> <li>pots of at least 20cm deep*</li> <li>trellis (for the vines to climb)</li> <li>seedlings tray</li> <li>seeds</li> </ul> <p>*as advised by <a href="https://gardeningsg.nparks.gov.sg/page-index/edible-plants/butterfly-pea/" target="_blank" rel="noopener noreferrer">NParks</a>.</p> <p>I got the seedling tray that has some holes in the bottom since I’m completely new at this so I might overwater the seedlings and I also the lid to protect it while it’s sitting on my balcony.</p> <p>I got the soil and seed, from a local seller for a combined of ~SGD5 and the rest I got off of AliExpress which totals to ~SGD10.</p> <p>I only just started to sow the seeds yesterday and we will see the result soon!</p> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/seedling_tray_starting-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/seedling_tray_starting-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/seedling_tray_starting-1400.webp"></source> <img src="/assets/img/seedling_tray_starting.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <h1 id="minor-automation">Minor automation</h1> <p>For now, the only sensor data I have is from 1 moisture sensor level using Zigbee (~SGD20). I had some issues with setting it up with HA as it is ZHA does not fully understand how to interpret the data coming from the model, <code class="language-plaintext highlighter-rouge">_TZE204_myd45weu</code>. Following the guide from the HA community <a href="https://community.home-assistant.io/t/ts0601-tze200-ga1maeof-soil-moisture-sensor-and-zha/590913" target="_blank" rel="noopener noreferrer">here</a>, I found out how to get ZHA to understand it with a custom “quirk” modified from this <a href="https://github.com/zigpy/zha-device-handlers/blob/92c9fbc6d01a5d86f78d64183302b906aa7d8215/zhaquirks/tuya/ts0601_sensor.py" target="_blank" rel="noopener noreferrer">original handler</a>.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-         MODELS_INFO: [("_TZE200_myd45weu", "TS0601")],
</span><span class="gi">+         MODELS_INFO: [("_TZE204_myd45weu", "TS0601")],
</span></code></pre></div></div> <p>After this fix and <a href="https://community.home-assistant.io/t/how-to-setup-local-zha-quirks/341226/2?u=sewenthy" target="_blank" rel="noopener noreferrer">enabling HA to use the quirks</a>, I managed to get the sensor moisture and temperature readings.</p> <p>I recorded the before and after watering moisture and temperature of the seedling tray, and I thought it was quite cool even though it’s quite a simple graph currently.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/soil_moist_temp_graph-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/soil_moist_temp_graph-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/soil_moist_temp_graph-1400.webp"></source> <img src="/assets/img/soil_moist_temp_graph.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/seedling_tray_moisture_sensor-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/seedling_tray_moisture_sensor-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/seedling_tray_moisture_sensor-1400.webp"></source> <img src="/assets/img/seedling_tray_moisture_sensor.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h1 id="plans-for-more-automation">Plans for more automation</h1> <h2 id="bees-checker">Bees Checker</h2> <p>One thing I want to get going is running a small computer vision model to check if the garden is receiving any pollinators–i.e. whether my butterfly pea plan works or not. This will help me decide on what kind of plants I can do after. Of course, I can just wait and chance upon some bees pollinating the garden but that wouldn’t be as fun as struggling for hours to get a model to process many images taken by a SGD25 IP camera and see if it can find the bees.</p> <p>My current plan is to find some light model off of <a href="https://huggingface.co/" target="_blank" rel="noopener noreferrer">huggingface</a>, ideally, something I can run locally with a small overworked GPU.</p> <h2 id="mysensors--drip-irrigations">MySensors &amp; Drip Irrigations</h2> <p>Since the moisture sensor I got was quite expensive for 1 sensor, I would want to expand my garden afterward with multiple pots, and sensors (much more data points for cool graphs) as well as having some kind of drip irrigation working off of that data. I need a more cost-effective method to get some readings. I found some capacitive sensors on Aliexpress for &lt;SGD1 each and it works with <a href="https://www.arduino.cc/" target="_blank" rel="noopener noreferrer">Arduino</a>. Great! It’s also a good thing I got the current Zigbee sensor because it is quite trusted, and well-tuned. I can fine-tune the data of the Arduino output to be similar to the current sensor.</p> <p>Having all that data is well-and-good but I also need to have it connect to HA somehow (otherwise, no cool graphs). This is when I chance upon <a href="https://www.mysensors.org/about/iot" target="_blank" rel="noopener noreferrer">MySensors</a> which will also supposedly work with HA.</p> <p>I got some equipment from AliExpress again:</p> <ul> <li>Zigbee soil moisture and temperature sensor</li> <li>Zigbee water pump</li> <li>drip irrigation pipes</li> <li>Nodemcu V2 ESP8266 (recommended by MySensors)</li> <li>Arduino UNO R3 with the starter kit</li> <li>5 pcs of capacitive soil moisture sensor</li> <li>jumper wires and breadboards</li> </ul> <p>This all went for ~SGD90 (ah, the price I pay for graphs).</p> <p>So this is my plan for the next few weeks–getting Arduino to read moisture sensors and pass it to my HA server. If all goes well then I’ll try making HA run the smart pump based on all the moisture sensors data. This will be slightly tricky as my balcony sadly do not have any water outlet. My plan is to use some kind of bucket (possibly with rain catchment into the bucket too), drill a hole at the bottom and use the pressure to run the pump.</p> <h3 id="ocaml-for-arduino">OCaml for Arduino?</h3> <p>I love OCaml so the obvious next steps is to maybe have the code I write to integrate these sensors and HA in OCaml. Although it looks like there’s not many widely used projects–I found a few that I made a fork of namely: <a href="https://github.com/sewenthy/OMicroB" target="_blank" rel="noopener noreferrer">OMicroB</a> and <a href="https://github.com/sewenthy/firmata" target="_blank" rel="noopener noreferrer">firmata</a>. I have not done much other than trying to get it to compile, but it’s on the back of my mind.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Sewen Thy. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. Last updated: August 10, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXFM2R0ZRR"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WXFM2R0ZRR");</script> </body> </html>